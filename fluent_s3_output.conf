<match kube.kube-system.**>
   @type s3
   log_level info
   s3_bucket "#{ENV['AWS_S3_BUCKET_NAME']}"
   s3_region "#{ENV['AWS_S3_LOGS_BUCKET_REGION']}"
   s3_object_key_format %{path}%{time_slice}/cluster-log-%{index}.%{file_extension}
   
   path "#{ENV['AWS_S3_LOGS_BUCKET_PREFIX_KUBESYSTEM']}"
   buffer_path /var/log/fluentd-buffer-kubesystem
   store_as json
   use_server_side_encryption aws:kms
   flush_interval 60s

   time_slice_format %Y/%m/%d
   time_slice_wait 10m
   utc

   <instance_profile_credentials>
     ip_address 169.254.169.254
     port       80b
   </instance_profile_credentials>
</match>

<match **>
   @type s3
   log_level info
   s3_bucket "#{ENV['AWS_S3_BUCKET_NAME']}"
   s3_region "#{ENV['AWS_S3_LOGS_BUCKET_REGION']}"
   s3_object_key_format %{path}%{time_slice}/cluster-log-%{index}.%{file_extension}
   
   path "#{ENV['AWS_S3_LOGS_BUCKET_PREFIX']}"
   buffer_path /var/log/fluentd-buffer
   store_as json
   use_server_side_encryption aws:kms
   flush_interval 60s

   time_slice_format %Y/%m/%d
   time_slice_wait 10m
   utc

   <instance_profile_credentials>
     ip_address 169.254.169.254
     port       80b
   </instance_profile_credentials>
</match>
